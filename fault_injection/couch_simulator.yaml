setup:
  version: '3'
  services:
    couch1:
      image: couchdb:latest
      network_mode: "none"
      cap_add:
      - NET_ADMIN
      command: sleep 1000
      environment:
        COUCHDB_PASSWORD: password
        COUCHDB_USER: couch_db
      ports:
        - 5984:10001
      volumes:
        - couch1:/tmp/docker/couch1_data
    couch2:
      image: couchdb:latest
      network_mode: "none"
      cap_add:
        - NET_ADMIN
      command: sleep 1000
      environment:
        COUCHDB_PASSWORD: password
        COUCHDB_USER: couch_db
      ports:
        - 5984:10002
      volumes:
        - couch2:/tmp/docker/couch2_data
    couch3:
      image: couchdb:latest
      network_mode: "none"
      cap_add:
      - NET_ADMIN
      command: sleep 1000
      environment:
        COUCHDB_PASSWORD: password
        COUCHDB_USER: couch_db
      ports:
        - 5984:10003
      volumes:
        - couch3:/tmp/docker/couch3_data

  volumes:
    couch1:
    couch2:
    couch3:
events:
  event1:
    do:
      join:
        container: ["couch1", "couch2", "couch3"]
        internal: True
        mode: ring
  event2:
    dependOn: ["event1"]
    commands:
      - docker ps
      - docker logs networksimulator_couch1_1
      - curl http://127.0.0.1:10001/
    cut:
      container: ["couch1", "couch2"]
    cut:
      container: ["couch1", "couch3"]
